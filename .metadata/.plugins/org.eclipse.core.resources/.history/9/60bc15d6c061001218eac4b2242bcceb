import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.io.UnsupportedEncodingException;
import java.net.URL;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.Properties;

import com.bigfatgun.fixjures.Fixjure;
import com.bigfatgun.fixjures.json.JSONSource;



public class three {

	/**
	 * @param args
	 * @throws IOException 
	 * @throws UnsupportedEncodingException 
	 * @throws ParseException 
	 */
	public static void main(String[] args) throws UnsupportedEncodingException, IOException {
		try {
			System.out.print("Search result 4: " + args[0] + "\n");
			
			URL url = new URL("http://search.twitter.com/search.json?rpp=3&q=" + args[0]);
			BufferedReader reader = null;

			String callback = new String();
			
			try {
			    reader = new BufferedReader(new InputStreamReader(url.openStream(), "UTF-8"));

			    for (String line; (line = reader.readLine()) != null;) {
			    	callback += line;
			    }
			    //System.out.println(
			    //		  "\n**************RAW*************************************\n"
			    //		+ callback 
			    //		+ "\n************END*RAW***********************************\n");
			
			    tweetData qtweetData = Fixjure.of(tweetData.class).from(JSONSource.newJsonString(callback)).create();
			    //ArrayList<tweetDetails> results = qtweetData.getResults(); // name now .equals("foo name");
			    String results_str = qtweetData.getResults();
			    //ArrayList results_arr = Fixjure.of(ArrayList.class).from(JSONSource.newJsonString(results_str)).create();
			    /*for(String result : results_arr) {
			    	System.out.println("result: " + result + "\n");
			    }*/
			    
			    results_str = results_str.replace("},{", "}01g4pk3y01{");
			    results_str = results_str.replace(",\"metadata\":{\"result_type\":\"recent\"}", "");
			    results_str = results_str.replace("\"geo\":null,", "");
			    results_str = results_str.replace("\"to_user_name\":null,", "");
			    results_str = results_str.replace("\"to_user\":null,", "");
			    String[] tmp = results_str.split("01g4pk3y01");
			    
			    //System.out.println("result: " + results_str);
			    
			    //String str = "one.two.three";
			    //String delimiter = "\\.";
			    //String[] temp = str.split(delimiter);
			    
			    tmp[0] = tmp[0].substring(1, tmp[0].length());
			    //System.out.println("tmp_arr length: " + tmp.length);
			    tmp[tmp.length - 1] = tmp[tmp.length - 1].substring(0, tmp[tmp.length - 1].length() - 1);
			    for(int i = 0; i < tmp.length ; i++) {
			    //System.out.println("tmp[0]: " + tmp[0]);
			    //String tt = tmp[0];
			    	tweetDetails qtweetDetails = Fixjure.of(tweetDetails.class).from(JSONSource.newJsonString(tmp[i])).create();
			    	String text = qtweetDetails.getText();
			    
			    	//tmp[i]= results_str.replace("},{", "}01g4pk3y01{");
			     	System.out.println("Text: " + text);
			     	
			     	
			     	
//----------------------MYSQL-----------------------------------------------
			     	Connection             conn  = null;        
			        PreparedStatement   pstmt = null;
			        ResultSet            rs    = null;
			        
			        try {
			                        
			             
			            Properties connInfo = new Properties();
			            
			            connInfo.put("characterEncoding","UTF8");
			            connInfo.put("user", "root");
			            connInfo.put("password", "usbw");
			            
			            conn  = DriverManager.getConnection("jdbc:mysql://localhost:3307/?", connInfo);
			            
			            pstmt = conn.prepareStatement("show databases;");
			            
			            if(pstmt.execute()) {
			                rs = pstmt.getResultSet();                                
			                
			                while (rs.next()) {
			                    //System.out.println(rs.getString(1));
			                    System.out.println(rs.getString("Database"));
			                }
			            }                                    
			        }
			        catch (SQLException ex) {            
			            System.out.println(ex.toString());
			            //ex.printStackTrace();
			        }
			        finally {
			            
			            try {
			                
			                if (pstmt != null)
			                    pstmt.close();
			                
			                if (conn != null)
			                    conn.close();                
			            }
			            catch (SQLException ex) {            
			                System.out.println("On close: " + ex.toString());
			                //ex.printStackTrace();
			            }                        
			            
			        }        

//--------------------MYSQL-END---------------------------------------------
			    }
			    
			} finally {
			    if (reader != null) try { reader.close(); } catch (IOException ignore) {}
			}
			
		} catch(ArrayIndexOutOfBoundsException e) {
			System.out.print("(.)(.)");
		}
	}
}
